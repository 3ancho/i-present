<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=1024, user-scalable=no">

    <title>Your deck.js Presentation</title>

    <!-- Required stylesheet -->
    <link rel="stylesheet" href="deck/core/deck.core.css">

    <!-- Extension CSS files go here. Remove or add as needed. -->
    <link rel="stylesheet" href="deck/extensions/goto/deck.goto.css">
    <link rel="stylesheet" href="deck/extensions/menu/deck.menu.css">
    <link rel="stylesheet" href="deck/extensions/navigation/deck.navigation.css">
    <link rel="stylesheet" href="deck/extensions/status/deck.status.css">
    <link rel="stylesheet" href="deck/extensions/hash/deck.hash.css">
    <link rel="stylesheet" href="deck/extensions/scale/deck.scale.css">

    <!-- Style theme. More available in /themes/style/ or create your own. -->
    <link rel="stylesheet" href="deck/themes/style/web-2.0.css">

    <!-- Transition theme. More available in /themes/transition/ or create your own. -->
    <link rel="stylesheet" href="deck/themes/transition/horizontal-slide.css">

    <!-- Required Modernizr file -->
    <script src="deck/modernizr.custom.js"></script>

    <!-- Customized by Ruoran -->
    <link rel="stylesheet" href="deck/custom.css">
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <!-- Ruoran -->
  </head>
  <body>
    <div class="container-fluid" style="margin-top: 20px">
      <div class="row-fluid span12">
        <article class="span8 deck-container" style="min-height: 560px">
        <!-- Begin slides. Just make elements with a class of slide. -->

        <section class="slide">
        <h1>Slide</h1>
        </section>

        <section class="slide">
        <h1>Content</h1>
        </section>

        <section class="slide">
        <h2>Here</h2>
        <p id="click">Click</p>
        </section>

        <!-- End slides. -->

        <!-- Begin extension snippets. Add or remove as needed. -->

        <!-- deck.navigation snippet -->
        <a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
        <a href="#" class="deck-next-link" title="Next">&#8594;</a>

        <!-- deck.status snippet -->
        <p class="deck-status">
        <span class="deck-status-current"></span>
        /
        <span class="deck-status-total"></span>
        </p>

        <!-- deck.goto snippet -->
        <form action="." method="get" class="goto-form">
          <label for="goto-slide">Go to slide:</label>
          <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
          <datalist id="goto-datalist"></datalist>
          <input type="submit" value="Go">
        </form>

        <!-- deck.hash snippet -->
        <a href="." title="Permalink to this slide" class="deck-permalink">#</a>

        <!-- End extension snippets. -->

        <!-- Required JS files. -->
        <script src="jquery-1.7.2.min.js"></script>
        <script src="deck/core/deck.core.js"></script>

        <!-- Extension JS files. Add or remove as needed. -->
        <script src="deck/core/deck.core.js"></script>
        <script src="deck/extensions/hash/deck.hash.js"></script>
        <script src="deck/extensions/menu/deck.menu.js"></script>
        <script src="deck/extensions/goto/deck.goto.js"></script>
        <script src="deck/extensions/status/deck.status.js"></script>
        <script src="deck/extensions/navigation/deck.navigation.js"></script>
        <script src="deck/extensions/scale/deck.scale.js"></script>
        <!-- Initialize the deck. You can put this in an external file if desired. -->

        </article>

        <aside id="side-bar" class="span3 well">
        <p id="client-count"> 0 </p>
        <p>Chat Window</p>

        <div id="chat-content" style="height: 300px">
        </div>

        <div class="input-append">
          <input id="chat-message" class="span10" type="text"></input>
          <button class="btn" type="button" id="say" >Say</button>
        </div>
        </aside>
      </div> <!-- end of div row -->
    </div> <!-- end of div container -->

    <script src="socket.io/socket.io.js"></script> 
    <script>
      // First class functions
      name = ""
      var socket = io.connect("http://localhost:3000");
      socket.on("news", function (data) {
        console.log(data.content);
        $("#client-count").text(data.clients);
      });

      socket.on("client_change_slide", function (data) {
        console.log(data);
        $.deck("go", data);
      });

      socket.on("message", function (data) {
        console.log(data);
        $("#chat-content").append("<p>" + data.name + ": " +  data.content + "</p>");
      });

      socket.on("client_count_update", function (data) {
        console.log(data);
        $("#client-count").text(data.clients);
      });

      // Helper functions
      function send_message() {
        if (name == "") {
          name = prompt("Enter your name first","Luke Skywalker");
          while (name == null || name == "") {
            name == prompt("Please enter your name","Luke Skywalker");
          }
        }
        var new_chat_message = $("#chat-message").val()
        socket.emit("message", {nickname: name, content: new_chat_message });
        $("#chat-content").append("<p>" + name + ": " + new_chat_message + "</p>");
        $("#chat-message").val("")
      }

      // jQuery Start
      $(document).ready(function() {
        $.deck(".slide");

        //$(document).bind("deck.change", function (event, from, to) {
        //  console.log(to);
        //  socket.emit("change_slide", to); 
        //});

        $("#say").click(send_message);

        $("form").each(function() {
          $("input").keypress(function(e) {
            if(e.which == 10 || e.which == 13) {
              send_message();
            }
          });
        });

      });
    </script>

  </body>
</html>
